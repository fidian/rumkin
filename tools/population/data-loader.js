"use strict";function _slicedToArray(r,e){return _arrayWithHoles(r)||_iterableToArrayLimit(r,e)||_unsupportedIterableToArray(r,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(r,e){if(r){if("string"==typeof r)return _arrayLikeToArray(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);return"Map"===(t="Object"===t&&r.constructor?r.constructor.name:t)||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,e):void 0}}function _arrayLikeToArray(r,e){(null==e||e>r.length)&&(e=r.length);for(var t=0,a=new Array(e);t<e;t++)a[t]=r[t];return a}function _iterableToArrayLimit(r,e){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var a,n,o=[],i=!0,l=!1;try{for(t=t.call(r);!(i=(a=t.next()).done)&&(o.push(a.value),!e||o.length!==e);i=!0);}catch(r){l=!0,n=r}finally{try{i||null==t.return||t.return()}finally{if(l)throw n}}return o}}function _arrayWithHoles(r){if(Array.isArray(r))return r}function _classCallCheck(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(r,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(r,a.key,a)}}function _createClass(r,e,t){return e&&_defineProperties(r.prototype,e),t&&_defineProperties(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}var DataLoader=function(){function r(){_classCallCheck(this,r),this.loadPromise=null}return _createClass(r,[{key:"load",value:function(){return this.loadPromise||(this.loadPromise=this.loadData()),this.loadPromise}},{key:"loadData",value:function(){var n=this;return Promise.all([m.request({url:"populations.json"}),m.request({url:"regions-rename.json"}),m.request({url:"stats-start-date.json"})]).then(function(r){var r=_slicedToArray(r,3),e=r[0],t=r[1],r=r[2],a={};return a.statsById=e,a.countries=n.filterAreas(e,{},function(r){return r.I<900}),a.regions=n.filterAreas(e,t,function(r){return 900<=r.I}),a.statsStartDate=new Date(r),n.update(a),setInterval(function(){return n.update(a)},100),a})}},{key:"filterAreas",value:function(r,e,t){for(var a=[],n=0,o=Object.values(r);n<o.length;n++){var i=o[n];t(i)&&a.push(i),e[i.I]&&(i.L=e[i.I])}return a.sort(function(r,e){r=r.L.toLowerCase(),e=e.L.toLowerCase();return r<e?-1:e<r?1:0}),a}},{key:"update",value:function(r){for(var e=0,t=Object.values(r.statsById);e<t.length;e++){var a=t[e];this.updateRegion(a,r.statsStartDate)}m.redraw()}},{key:"updateRegion",value:function(r,e){var t=new Date,t=(r.days=(t-e)/864e5,r.days/365.2425);r.births=Math.floor(r.B*t),r.deaths=Math.floor(r.D*t),r.migrations=Math.floor(r.M*t),r.population=r.P+r.births-r.deaths+r.migrations}}]),r}();module.exports=new DataLoader;