"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _createForOfIteratorHelper(t,e){var r,n,o,a,i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(i)return n=!(r=!0),{s:function(){i=i.call(t)},n:function(){var t=i.next();return r=t.done,t},e:function(t){n=!0,o=t},f:function(){try{r||null==i.return||i.return()}finally{if(n)throw o}}};if(Array.isArray(t)||(i=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length)return i&&(t=i),a=0,{s:e=function(){},n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:e};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){var r;if(t)return"string"==typeof t?_arrayLikeToArray(t,e):"Map"===(r="Object"===(r=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:r)||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(t,e):void 0}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,_toPropertyKey(n.key),n)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(t,e){if("object"!==_typeof(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0===r)return("string"===e?String:Number)(t);r=r.call(t,e||"default");if("object"!==_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}var AdvancedInputArea=require("../advanced-input-area"),cipherConduitSetup=require("../cipher-conduit-setup"),CipherResult=require("../cipher-result"),DirectionSelector=require("../direction-selector"),Dropdown=require("../../../js/mithril/dropdown"),keyAlphabet=require("../key-alphabet"),KeyedAlphabet=require("../keyed-alphabet"),Result=require("../result");module.exports=function(){function t(){var i=this;_classCallCheck(this,t),this.direction={},this.alphabet={value:new rumkinCipher.alphabet.English,onchange:function(){return i.resetTranslations()}},this.input={label:"The message to encipher or decipher",value:""},this.resetTranslations(),cipherConduitSetup(this,"bifid",function(t){i.resetTranslations();var e,r=0,n=_createForOfIteratorHelper((t.translations||"").split(" "));try{for(n.s();!(e=n.n()).done;){var o=e.value,a=i.translations[r];a&&(a.from=o[0],a.to=o[1]),r+=1}}catch(t){n.e(t)}finally{n.f()}})}return _createClass(t,[{key:"resetTranslations",value:function(){var t=keyAlphabet(this.alphabet),e=Math.floor(Math.sqrt(t.length)),r=t.length-e*e;for(this.translations=[];this.translations.length<r;){var n=t.toLetter(0),o=t.toLetter(1),a=t.toIndex("I"),i=t.toIndex("J");-1!==a&&-1!==i&&(n="J",o="I"),this.translations.push({from:n,to:o,sourceAlphabet:t}),t=t.collapse(n,o)}this.alphabetInstance=t}},{key:"updateAlphabet",value:function(){var t,e=keyAlphabet(this.alphabet),r=_createForOfIteratorHelper(this.translations);try{for(r.s();!(t=r.n()).done;){var n=t.value,o=e.toIndex(n.from),a=e.toIndex(n.to);-1===o&&(n.from=e.toLetter(0)),-1===a&&(n.to=e.toLetter(0)),n.from===n.to&&(n.to=e.toLetter(0),n.from===n.to)&&(n.to=e.toLetter(1)),e=(n.sourceAlphabet=e).collapse(n.from,n.to)}}catch(t){r.e(t)}finally{r.f()}this.alphabetInstance=e}},{key:"view",value:function(){return[m("p",m(DirectionSelector,this.direction)),m("p",m(KeyedAlphabet,this.alphabet)),this.viewTranslations(),this.viewTableau(),m("p",m(AdvancedInputArea,this.input)),m("p",this.viewResult())]}},{key:"viewResult",value:function(){return this.input.value?m(CipherResult,{name:"bifid",direction:this.direction.value,message:this.input.value,alphabet:this.alphabetInstance}):m(Result,"Enter text to see it encoded here")}},{key:"viewTableau",value:function(){for(var t=this.alphabetInstance,e=Math.sqrt(t.length),r="",n=0;n<e;n+=1){for(var o=0;o<e;o+=1)r+=t.toLetter(n*e+o)+" ";r=r.trim()+"\n"}return m("p",["Your tableau: ",m("span",{class:"D(if) Jc(c)"},m("pre",{class:"Mt(0)"},r))])}},{key:"viewTranslations",value:function(){var a=this;return 0===this.translations.length?null:this.translations.map(function(e){for(var t={options:{},value:e.from,onchange:function(t){e.from=t.target.value,a.updateAlphabet()}},r={options:{},value:e.to,onchange:function(t){e.to=t.target.value,a.updateAlphabet()}},n=0;n<e.sourceAlphabet.length;n+=1){var o=e.sourceAlphabet.toLetter(n);(t.options[o]=o)!==t.value&&(r.options[o]=o)}return m("p",["Translate ",m(Dropdown,t)," into ",m(Dropdown,r)])})}}]),t}();