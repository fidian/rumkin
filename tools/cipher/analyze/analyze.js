"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _createForOfIteratorHelper(e,t){var r,n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return n&&(e=n),r=0,{s:t=function(){},n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){o=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(o)throw a}}}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,i=[],o=!0,l=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);o=!0);}catch(e){l=!0,a=e}finally{try{o||null==r.return||r.return()}finally{if(l)throw a}}return i}}function _arrayWithHoles(e){if(Array.isArray(e))return e}for(var AdvancedInputArea=require("../advanced-input-area"),AlphabetSelector=require("../alphabet-selector"),BarChart=require("../../../js/mithril/bar-chart"),characterPropertiesJson=require("../character-properties.json"),characterProperties=[],_loop=function(){var e=_slicedToArray(_Object$entries[_i],2),t=e[0],r=e[1].map(function(e){return Array.isArray(e)?e:[e,e]}),n=Math.min(r.map(function(e){return e[0]})),a=Math.max(r.map(function(e){return e[1]})),e=r.reduce(function(e,t){return e+t[1]-t[0]+1},0);characterProperties.push({name:t,ranges:r,min:n,max:a,total:e,test:function(t){return!(t<n||a<t)&&r.some(function(e){return t>=e[0]&&t<=e[1]})}})},_i=0,_Object$entries=Object.entries(characterPropertiesJson);_i<_Object$entries.length;_i++)_loop();var printableChar={0:"NUL",1:"SOH",2:"STX",3:"ETX",4:"EOT",5:"ENQ",6:"ACK",7:"BEL",8:"BS",9:"TAB",10:"LF",11:"VT",12:"FF",13:"CR",14:"SO",15:"SI",16:"DLE",17:"DC1",18:"DC2",19:"DC3",20:"DC4",21:"NAK",22:"SYN",23:"ETB",24:"CAN",25:"EM",26:"SUB",27:"ESC",28:"FS",29:"GS",30:"RS",31:"US",32:"SP",127:"DEL"};module.exports=function(){function e(){_classCallCheck(this,e),this.alphabet={value:new rumkinCipher.alphabet.English},this.input={value:""},this.showDetail=new Map,this.showDetailType=new Map}return _createClass(e,[{key:"view",value:function(){return[m(AlphabetSelector,this.alphabet),m(AdvancedInputArea,this.input),this.viewProperties()]}},{key:"viewProperties",value:function(){if(!this.input.value.length)return[];var e,t=new Map,r=_createForOfIteratorHelper(this.input.value.split(""));try{for(r.s();!(e=r.n()).done;)for(var n=e.value,a=n.charCodeAt(0),i=0,o=characterProperties;i<o.length;i++){var l,u,c=o[i];c.test(a)&&(l=c.name,(u=t.get(l))||(u={characterProperties:c,count:0,key:l,matches:new Map},t.set(l,u)),u.count+=1,u.matches.set(n,1+(u.matches.get(n)||0)))}}catch(e){r.e(e)}finally{r.f()}return[this.viewCalculated(),this.viewExpandableSections(t)]}},{key:"viewCalculated",value:function(){var e=new rumkinCipher.util.Message(this.input.value),t=rumkinCipher.util.kappaPlaintext(e),e=rumkinCipher.util.indexOfCoincidence(e,this.alphabet.value);return m("p",["Length: ".concat(this.input.value.length),m("br"),"Kappa plaintext: ".concat(t.toLocaleString()),m("br"),"Friedman index of coincidence: ".concat(e.toLocaleString())])}},{key:"viewExpandableSections",value:function(e){var t=this;return _toConsumableArray(e.values()).sort(function(e,t){return e.key.localeCompare(t.key)}).map(function(e){return t.viewExpandableSection(e)})}},{key:"viewExpandableSection",value:function(e){var t=this,r=[m("b",e.key)," (".concat(e.count," occurrences, ").concat(e.matches.size," distinct)")];return[m("p",{class:"Us(n)"},m("a",{href:"#",onclick:function(){t.showDetail.set(e.key,!t.showDetail.get(e.key))}},[this.showDetail.get(e.key)?"▼ ":"▲ ",r])),this.viewExpandableDetail(e)]}},{key:"viewExpandableDetail",value:function(e){if(!this.showDetail.get(e.key))return[];var t=this.showDetailType.get(e.key);return"frequency"===t?this.viewExpandableFrequency(e):"full"===t?this.viewExpandableFull(e):this.viewExpandableMatches(e)}},{key:"viewExpandableFrequency",value:function(e){var t=this,r=_toConsumableArray(e.matches).map(function(e){return t.viewDataEntry(e[0],e[1])}).sort(function(e,t){var r=t.n-e.n;return r||e.c.charCodeAt(0)-t.c.charCodeAt(0)});return m("div",[this.viewExpandableHeader(e.key),this.viewBarChart(r)])}},{key:"viewExpandableFull",value:function(e){function t(){for(var e=o.shift(),t=0,r=o;t<r.length;t++){var n=r[t];n.prevCount+=e.thisCount,e.nextCount+=n.thisCount}e.thisCount+e.nextCount+e.prevCount?a.push(e):a.length&&(a=[],i.push(a))}var r,n=this,a=[],i=[a],o=[],l=_createForOfIteratorHelper(e.characterProperties.ranges);try{for(l.s();!(r=l.n()).done;)for(var u=r.value,c=u[0];c<=u[1];c+=1){var s=String.fromCharCode(c),h=this.viewDataEntry(s,e.matches.get(s)||0);c===h.cc&&(10<=o.length&&t(),o.push({dataEntry:h,prevCount:0,nextCount:0,thisCount:h.n?1:0}))}}catch(e){l.e(e)}finally{l.f()}for(;o.length;)t();return 0===a.length&&i.pop(),m("div",[this.viewExpandableHeader(e.key),i.map(function(e){return n.viewBarChart(e.map(function(e){return e.dataEntry}))})])}},{key:"viewExpandableMatches",value:function(e){var t=this,r=_toConsumableArray(e.matches).map(function(e){return t.viewDataEntry(e[0],e[1])}).sort(function(e,t){return e.cc-t.cc});return m("div",[this.viewExpandableHeader(e.key),this.viewBarChart(r)])}},{key:"viewDataEntry",value:function(e,t){var r=e.charCodeAt(0);return{c:e,cc:r,label:printableChar[r]||e,n:t}}},{key:"viewContent",value:function(e){return m("div",{class:"Bdstartw(1px) Bdendw(1px) Bdbw(1px) P(0.5em)"},e)}},{key:"viewExpandableHeader",value:function(e){function t(e){var t="Px(0.5em) Pt(0.25em) Pb(0.1em) Bdrststart(0.75em) Bdrstend(0.75em) Bdstartw(1px) Bdtw(1px) Bdendw(1px) Bdbw(1px) Fxs(0) Us(n)";return t+=e?" Bgc(white) Bdbc(t)":" Bgc(lightgrey)"}var r=this,n=this.showDetailType.get(e),a="W(0.2em) Bdbw(1px)";return m("div",{class:"D(f)"},[m("div",{class:a}),m("div",{class:t("frequency"!==n&&"full"!==n),onclick:function(){return r.showDetailType.set(e,"matches")}},"Matches"),m("div",{class:a}),m("div",{class:t("frequency"===n),onclick:function(){return r.showDetailType.set(e,"frequency")}},"By Frequency"),m("div",{class:a}),m("div",{class:t("full"===n),onclick:function(){return r.showDetailType.set(e,"full")}},"With Nearby"),m("div",{class:"W(100%) Bdbw(1px)"})])}},{key:"viewBarChart",value:function(e){return m(BarChart,{columns:[{label:"Char",property:"label",attrs:{align:"center"}},{label:"Count",property:"n",attrs:{align:"right"}},{label:"Bar",property:"n",barChart:!0}],data:e})}}]),e}();