"use strict";!function(){function c(t,o){var e,n,r,i,u,s,c,l={};return l.bySum=function(t,o){for(var e,n,r,i={},u=[],s=0;s<t.length;s+=1){for(n=t[s],e=r=0;e<n.length;e+=1)r+=n[e];i[r+=o]?i[r].count+=1:(i[r]={sum:r,count:1},u.push(i[r]))}return u.sort(function(t,o){return t.sum-o.sum})}(t,o),t=l,u=i=r=0,angular.forEach(t.bySum,function(t){(void 0===n||t.sum<n)&&(n=t.sum),(void 0===e||t.sum>e)&&(e=t.sum),t.count>i&&(i=t.count),r+=t.count,u+=t.sum*t.count}),t.maxRoll=e,t.minRoll=n,t.totalPossibilities=r,t.maxFrequency=i,t.sum=u,t.average=u/r,s=l,c=0,angular.forEach(s.bySum,function(t){var o;t.probability=t.count/s.totalPossibilities,t.probabilityPercent=100*t.probability,t.percentOfMax=100*t.count/s.maxFrequency,o=t.sum-s.average,c+=o*o*t.count}),s.stdDev=Math.sqrt(c/s.totalPossibilities),l}function l(t,o,e){for(var n=0;n<t.length;n+=1)t[n]=t[n].slice(o,e)}angular.module("dieroll",[]).controller("DierollController",["$scope","$timeout",function(u,s){var n;u.dice=3,u.sides=6,u.dropLowest=0,u.dropHighest=0,u.modifier=0,u.setRoll=function(t,o,e,n,r){u.dice=t,u.sides=o,u.dropLowest=e||0,u.dropHighest=n||0,u.modifier=r||0},u.$watchCollection("[dice, sides, dropLowest, dropHighest, modifier]",function(){var r,o;function t(){u.genStatus="done"}function i(){return u.statistics=c(r,u.modifier),r=null,s(t,1)}function e(){var t;if(u.genStatus="dropping",u.dropLowest||u.dropHighest){var o,e=r;function n(t,o){return t-o}for(o=0;o<e.length;o+=1)e[o].sort(n);t=u.dice}u.dropLowest&&(l(r,u.dropLowest,t),t-=u.dropLowest),u.dropHighest&&l(r,0,t-u.dropHighest),s(i,1)}n&&(s.cancel(n),n=null),r=[],o=0,u.genStatus="delay",u.rollStats={},n=s(function t(){return u.genStatus="rolling",r=function(t,o){var e,n,r=[];if(0===t.length)for(e=1;e<=o;e+=1)r.push([e]);else for(e=1;e<=o;e+=1)for(n=0;n<t.length;n+=1)r.push(t[n].concat(e));return r}(r,u.sides),(o+=1)<u.dice?s(t,1):s(e,1)},1e3)})}])}();