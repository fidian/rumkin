"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(r="Object"===r&&t.constructor?t.constructor.name:r)||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(t,e):void 0}}function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}var Parser=require("./parser"),parser=new Parser,Roller=require("./roller"),roller=new Roller;module.exports=function(){function t(){_classCallCheck(this,t),this.input="",this.isEmpty=!0,this.isWorking=!1,this.isInvalid=!1,this.min=0,this.max=0,this.avg=0,this.stdDev=0,this.result=null,this.calculatingMessage="",window.diceInstance=this}return _createClass(t,[{key:"oninit",value:function(){this.input=m.route.param("dice")||"",this.update()}},{key:"update",value:function(){var e=this,t=(this.input||"").replace(/[^-+0-9dDP,()]/g,"");if(m.route.set("/",{dice:t.trim()}),this.isEmpty=!1,this.isWorking=!1,this.isInvalid=!1,""===t)this.isEmpty=!0;else try{this.calculatingMessage="Initial setup";var r=parser.parse(t);this.isWorking=!0,roller.calculate(r,function(t){e.isWorking=!1,e.result=t,m.redraw()},function(t){e.calculatingMessage=t,m.redraw()})}catch(t){this.isInvalid=!0,this.invalidMessage=t.toString()}}},{key:"setInput",value:function(t){t!==this.input&&(this.input=t,this.update())}},{key:"view",value:function(){var e=this;return[m("p",["What do you want to roll?",m("br"),m("input",{type:"text",value:this.input,onchange:function(t){e.setInput(t.target.value)},disabled:this.isWorking})]),this.viewResults()]}},{key:"viewResults",value:function(){return this.isInvalid?m("p","Syntax is invalid and needs to be corrected: ".concat(this.invalidMessage)):this.isWorking?m("p","Calculating statistics: ".concat(this.calculatingMessage)):this.isEmpty?[]:[m("p",["Min: ".concat(this.result.minRolls),m("br"),"Max: ".concat(this.result.maxRolls),m("br"),"Average (Mean): ".concat(this.result.avg),m("br"),"Standard Deviation: ".concat(this.result.stdDev)]),m("table",[m("tr",[m("th","Roll"),m("th","Freq"),m("th","Prob"),m("th","Bar")])].concat(_toConsumableArray(this.viewRolls(this.result.rolls))))]}},{key:"viewRolls",value:function(){var a=this,n={width:"1%",align:"right"},s=[];return this.result.rolls.forEach(function(t,e){var t=t[0],r=e/a.result.totalRolls,i=100*e/a.result.maxCount;s.push(m("tr",[m("td",n,t),m("td",n,e.toLocaleString()),m("td",n,r.toFixed(5)),m("td",{valign:"center"},m("div",{class:"Bgc(blue) H(0.8em)",style:"width: ".concat(i.toFixed(2),"%")}))]))}),s}}]),t}();