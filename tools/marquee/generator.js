"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _createForOfIteratorHelper(e,t){var n,r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return r&&(e=r),n=0,{s:t=function(){},n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){o=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(o)throw a}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var depends={random:require("./depends/random"),randomInt:require("./depends/random-int"),range:require("./depends/range"),repeat:require("./depends/repeat")},show={cryptography:require("./show/cryptography"),implode:require("./show/implode"),none:require("./show/none"),slam:require("./show/slam"),slideLeft:require("./show/slide-left"),slideRight:require("./show/slide-right"),typing:require("./show/typing")},hide={backspace:require("./hide/backspace"),explode:require("./hide/explode"),flyOff:require("./hide/fly-off"),none:require("./hide/none"),slideLeft:require("./hide/slide-left"),slideRight:require("./hide/slide-right")},Timeout=require("./timeout");module.exports=function(){function e(){_classCallCheck(this,e),this.message="",this.betweenDelay=.5,this.readDelay=1.5,this.showMethod="none",this.hideMethod="none",this.animationList=[],this.repeat=!0,this.functionExtra="",this.jQueryExtra="",this.timeout=new Timeout,this.generatedCode=this.generateCode(),this.preview=this.makePreview()}return _createClass(e,[{key:"generateCode",value:function(){return 0===this.animationList.length?"// No animations in list":"(function () {\n    ".concat(this.indent(this.generateCodeDepends()),"\n\n    ").concat(this.indent(this.generateCodeMethod("show")),"\n\n    ").concat(this.indent(this.generateCodeMethod("hide")),"\n\n    ").concat(this.indent(this.generateCodeDelay()),"\n\n    ").concat(this.indent(this.generateCodeSteps()),"\n\n    ").concat(this.indent(this.generateCodeWriter()),"\n\n    ").concat(this.indent(this.generateCodeAnimate()),"\n})()")}},{key:"generateCodeAnimate",value:function(){var e=this.repeat?"\n    steps.push(step);":"";return"function nextStep() {\n    const step = steps.shift();".concat(e,"\n\n    if (step) {\n        runFunction(step);\n    }\n}\n\nfunction runFunction(fn) {\n    const result = fn();\n\n    if (result[0] !== null) {\n        writer(result[0]);\n    }\n\n    if (result[2]) {\n        setTimeout(function () {\n            runFunction(result[2]);\n        }, result[1]);\n    } else {\n        nextStep();\n    }\n}\n\nwindow.addEventListener('load', nextStep)")}},{key:"generateCodeDelay",value:function(){var e,t=_createForOfIteratorHelper(this.animationList);try{for(t.s();!(e=t.n()).done;){var n=e.value;if(n.readDelay||n.betweenDelay)return"// Delay function between animations\nfunction delay(seconds) {\n    return [null, seconds * 1000, function () {\n        return [null];\n    }];\n}"}}catch(e){t.e(e)}finally{t.f()}return"// Delay function not needed"}},{key:"generateCodeDepends",value:function(){var e,t=this,n={},r=_createForOfIteratorHelper(this.animationList);try{for(r.s();!(e=r.n()).done;){var a,i=e.value,o=_createForOfIteratorHelper(i.show.depends||[]);try{for(o.s();!(a=o.n()).done;){var s=a.value;n[s]=depends[s]}}catch(e){o.e(e)}finally{o.f()}var u,l=_createForOfIteratorHelper(i.hide.depends||[]);try{for(l.s();!(u=l.n()).done;){var c=u.value;n[c]=depends[c]}}catch(e){l.e(e)}finally{l.f()}}}catch(e){r.e(e)}finally{r.f()}if(!Object.keys(n).length)return"// No dependencies";var h=Object.entries(n).map(function(e){return"".concat(e[0],": ").concat(t.generateCodeFunction(e[1]))}).join(",\n");return"// Dependencies\nconst depends = {\n    ".concat(this.indent(h),"\n};")}},{key:"generateCodeFunction",value:function(e){for(var t,e=e.toString(),n=e.split(/\n/g),r=(n.shift(),n.length?e.length:0);n.length;){var a=n.shift();a.length&&(a=a.match(/^ */)[0].length,r=Math.min(a,r))}return r&&(t=new RegExp("^".concat(depends.repeat(" ",r)),"gm"),e=e.replace(t,"")),e}},{key:"generateCodeMethod",value:function(e){var t,n=this,r={},a=_createForOfIteratorHelper(this.animationList);try{for(a.s();!(t=a.n()).done;){var i=t.value;r[i[e].key]=i[e].method}}catch(e){a.e(e)}finally{a.f()}if(!Object.keys(r).length)return"// No methods: ".concat(e);var o=Object.entries(r).map(function(e){return"".concat(e[0],": ").concat(n.generateCodeFunction(e[1]))}).join(",\n");return"// Methods: ".concat(e,"\nconst ").concat(e," = {\n    ").concat(this.indent(o),"\n};")}},{key:"generateCodeSteps",value:function(){var e,t=[],n=_createForOfIteratorHelper(this.animationList);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push(this.generateCodeStepsMethod(r,"show",r.show,r.showVariables)),r.readDelay&&t.push(this.generateCodeStepsDelay(r.readDelay)),t.push(this.generateCodeStepsMethod(r,"hide",r.hide,r.hideVariables)),r.betweenDelay&&t.push(this.generateCodeStepsDelay(r.betweenDelay))}}catch(e){n.e(e)}finally{n.f()}return"const steps = [\n    ".concat(this.indent(t.join(",\n")),"\n];")}},{key:"generateCodeStepsDelay",value:function(e){return"function () { return delay(".concat(e,"); }")}},{key:"generateCodeStepsMethod",value:function(e,t,n,r){var a,i=[JSON.stringify(e.message)],o=_createForOfIteratorHelper(r);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push(JSON.stringify(s))}}catch(e){o.e(e)}finally{o.f()}var u,l=_createForOfIteratorHelper(n.depends||[]);try{for(l.s();!(u=l.n()).done;){var c=u.value;i.push("depends.".concat(c))}}catch(e){l.e(e)}finally{l.f()}return"function () { return ".concat(t,".").concat(n.key,"(").concat(i.join(", "),"); }")}},{key:"generateCodeWriter",value:function(){switch(this.writeMethod){case"window.status":return"function writer(msg) {\n    window.status = msg;\n}";case"jQuery.text":return"function writer(msg) {\n    $(".concat(JSON.stringify(this.jQueryExtra),").text(msg);\n}");default:return"function writer(msg) {\n    ".concat(this.functionExtra,"(msg);\n}")}}},{key:"indent",value:function(e){return e.replace(/\n/g,"\n    ")}},{key:"makePreview",value:function(){return{message:this.message,show:show[this.showMethod],showVariables:this.getVariables(show[this.showMethod]),readDelay:this.readDelay,hide:hide[this.hideMethod],hideVariables:this.getVariables(show[this.hideMethod]),betweenDelay:this.betweenDelay}}},{key:"getVariables",value:function(e){var t,n=[],r=_createForOfIteratorHelper(e.variables||[]);try{for(r.s();!(t=r.n()).done;){var a=t.value,i=void 0===a.currentValue?a.default:a.currentValue;n.push(i)}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"updateDemo",value:function(){this.timeout.clear();function e(e){document.getElementById("generator-demo").value=e}function t(){var e=n.shift();n.push(e),e()}var n=[];n.push(this.stepCallMethod(this.preview.show,this.preview.showVariables,this.preview.message,e,t)),this.preview.readDelay&&n.push(this.stepDelayFn(t,this.preview.readDelay)),n.push(this.stepCallMethod(this.preview.hide,this.preview.hideVariables,this.preview.message,e,t)),this.preview.betweenDelay&&n.push(this.stepDelayFn(t,this.preview.betweenDelay)),t()}},{key:"stepCallMethod",value:function(a,i,o,n,r){function s(e){var t=e();Array.isArray(t)||r(),n(t[0]),t[2]?u.timeout.set(t[1],function(){s(t[2])}):r()}var u=this;return function(){var e,t=[o].concat(_toConsumableArray(i)),n=_createForOfIteratorHelper(a.depends||[]);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push(depends[r])}}catch(e){n.e(e)}finally{n.f()}s(function(){return a.method.apply(a,_toConsumableArray(t))})}}},{key:"stepDelayFn",value:function(e,t){var n=this;return function(){n.timeout.set(1e3*t,e)}}},{key:"update",value:function(){this.preview=this.makePreview(),this.updateDemo(),this.generatedCode=this.generateCode()}},{key:"addConfig",value:function(e){this.animationList.push(e),this.update()}},{key:"writeSelect",value:function(n,e,t){var r=this;return m("p",[t,m("select",{onchange:function(e){r[n]=e.target.value,r.update()}},Object.entries(e).map(function(e){var e=_slicedToArray(e,2),t=e[0],e=e[1];return m("option",{value:t,selected:r[n]===t},e.title)}))])}},{key:"viewMethodDetail",value:function(e){var t,n=this,r=e.variables||[],a=_createForOfIteratorHelper(r);try{for(a.s();!(t=a.n()).done;){var i=t.value;void 0===i.currentValue&&(i.currentValue=i.default)}}catch(e){a.e(e)}finally{a.f()}return m("div",{class:"Pstart(3em) Mb(0.5em)"},[m("p",e.description)].concat(_toConsumableArray(r.map(function(t){return m("div",["".concat(t.name,": "),m("input",{type:"text",class:"W(5em)",value:t.currentValue,oninput:function(e){t.isNumeric?t.currentValue=+e.target.value:t.currentValue=e.target.value,n.update()}})," ".concat(t.description)])}))))}},{key:"viewDelay",value:function(t,e){var n=this;return m("div",[e,m("input",{type:"text",value:this[t],class:"W(5em)",oninput:function(e){n[t]=+e.target.value,n.update()}})])}},{key:"viewWriteMethodAdditional",value:function(){var t=this;switch(this.writeMethod){case"window.status":return m("p","Warning: this method is blocked by most browsers.");case"jQuery.text":return m("p",["Element selector: ",m("input",{type:"text",value:this.jQueryExtra,onkeyup:function(e){t.jQueryExtra=e.target.value,t.update()},onchange:function(e){t.jQueryExtra=e.target.value,t.update()}}),m("br"),"Result: ",m("tt",m("code","$(".concat(JSON.stringify(this.jQueryExtra),').text("message goes here");')))]);default:return m("p",["Name of function to call: ",m("input",{type:"text",value:this.functionExtra,onkeyup:function(e){t.functionExtra=e.target.value,t.update()},onchange:function(e){t.functionExtra=e.target.value,t.update()}}),m("br"),"Sample call: ",m("tt",m("code","".concat(this.functionExtra,'("message goes here");')))])}}},{key:"viewAnimationList",value:function(){return this.animationList.length?[m("h2","Animations"),m("ul",this.animationList.map(function(e){return m("li",e.message)}))]:""}},{key:"viewGeneratedCode",value:function(){return this.generatedCode?m("pre",m("code",this.generatedCode)):""}},{key:"view",value:function(){var t=this;return[m("h2","Customize your message"),m("p",m("input",{type:"text",placeholder:"Write your message here",class:"W(100%)",value:this.message,oninput:function(e){t.message=e.target.value,t.update()}})),this.writeSelect("showMethod",show,"Method for showing: "),this.viewMethodDetail(show[this.showMethod]),this.viewDelay("readDelay","Delay after showing, in seconds: "),this.writeSelect("hideMethod",hide,"Method for hiding: "),this.viewMethodDetail(hide[this.hideMethod]),this.viewDelay("betweenDelay","Delay after hiding, in seconds: "),m("h2","Demo of this message (loops continually)"),m("p",m("input#generator-demo",{type:"text",disabled:"disabled",class:"W(100%)"})),m("h2","Build a sequence of messages"),m("p",m("button",{onclick:function(){return t.addConfig(t.preview)}},"Add This Message")),this.viewAnimationList(),m("h2","Generated Code Options"),this.writeSelect("repeat",{true:{title:"loop forever."},false:{title:"display only once."}},"The generated code should "),this.writeSelect("writeMethod",{function:{title:"a function call"},"jQuery.text":{title:"using jQuery.text."},"window.status":{title:"setting window.status."}},"Write the message using "),this.viewWriteMethodAdditional(),m("h2","Result"),this.viewGeneratedCode()]}}]),e}();