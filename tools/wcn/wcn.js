"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var Checkbox=require("../../js/mithril/checkbox"),Dropdown=require("../../js/mithril/dropdown"),TextInput=require("../../js/mithril/text-input");module.exports=function(){function e(){_classCallCheck(this,e),this.connectionType={label:"Connection type",options:{ESS:"Infrastructure mode (ESS, uses access point)",IBSS:"Ad-Hoc (IBSS, peer to peer)"},value:"ESS"},this.authentication={label:"Authentication",options:{open:"Open network",shared:"Shared","WPA-NONE":"WPA-NONE",WPA:"WPA","WPA-PSK":"WPA-PSK",WPA2:"WPA2","WPA2-PSK":"WPA2-PSK"},value:"open"},this.encryption={label:"Encryption",options:{none:"No encryption",WEP:"WEP (Insecure)",TKIP:"TKIP",AES:"AES"},value:"none"},this.ssid={label:"SSID (required)",value:""},this.networkKey={label:"Network key (required if there is encryption)",value:""},this.automatically={label:"Key is provided automatically",value:!1},this.ieee802dot1x={label:"IEEE 802.1x enabled",value:!1},this.autorun={label:"Include an Autorun file",value:!1},this.batch={label:"Include batch file that runs the setup program",value:!1}}return _createClass(e,[{key:"view",value:function(){var e=this;return[m("p",m(TextInput,this.ssid)),m("p",m(Dropdown,this.connectionType)),m("p",m(Dropdown,this.authentication)),m("p",m(Dropdown,this.encryption)),m("p",m(TextInput,this.networkKey)),m("p",m(Checkbox,this.automatically)),m("p",m(Checkbox,this.ieee802dot1x)),m("p",m(Checkbox,this.autorun)),m("p",m(Checkbox,this.batch)),m("p",[m("button",{onclick:function(){e.generate()}},"Generate WCN Zip File")])]}},{key:"parseTemplate",value:function(r,a){var l=this;return r.file(a).async("string").then(function(e){l.automaticallyNumber={value:l.automatically?1:0},l.ieee802dot1xNumber={value:l.ieee802dot1x?1:0};for(var t=e.split("{{"),n=t.shift();t.length;){var i=t.shift().split("}}"),o=i.shift();o in l&&(n+=l[o].value.toString()),n+=i.join("}}")}r.file(a,n)})}},{key:"generate",value:function(){var i=this;JSZipUtils.getBinaryContent("wireless-settings.zip",function(e,t){var n;e?alert(e.toString()):(n=new JSZip).loadAsync(t).then(function(){return i.autorun.value||(n.remove("AUTORUN.INF"),n.remove("SMRTNTKY/fcw.ico")),i.batch.value||n.remove("Install_Wireless.bat"),i.parseTemplate(n,"SMRTNTKY/WSETTING.TXT")}).then(function(){return i.parseTemplate(n,"SMRTNTKY/WSETTING.WFC")}).then(function(){return n.generateAsync({compression:"DEFLATE",type:"blob"})}).then(function(e){saveAs(e,"wireless-settings.zip",!0)}).then(null,function(e){console.log(e),console.log(e.toString()),alert(e.toString())})})}}]),e}();