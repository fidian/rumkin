<!DOCTYPE html><html lang=en class="H(100%) Ovy(h)"><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Palm OS Programming - Advanced UI Elements</title><link rel=stylesheet href=../../../css/reset.css><link rel=stylesheet href=../../../css/atomic.css><link rel=stylesheet href=../../../css/fonts.css><link rel=stylesheet href=../../../css/site.css><link rel=apple-touch-icon sizes=180x180 href=../../../img/favicon/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../../img/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../../img/favicon/favicon-16x16.png><link rel=manifest href=../../../img/favicon/manifest.json><link rel=mask-icon href=../../../img/favicon/safari-pinned-tab.svg color=#5bbad5><link rel="shortcut icon" href=../../../img/favicon/favicon.ico><meta name=msapplication-config content=../../../img/favicon/browserconfig.xml><meta name=theme-color content=#ffffff><link rel=license href=../../../license><script async src="https://www.googletagmanager.com/gtag/js?id=G-H1S197ZSNH"></script><script>window.dataLayer = window.dataLayer || [];
function gtag() { dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'G-H1S197ZSNH');</script></head><body class="H(100%) Ovx(h) Bgc(pageBorderBackground) Bgc(t)--p"><div class="Maw(1002px) H(100%) W(100%) D(f) Fxd(c) Maw(100%)--p Mx(a) Mx(0)--p"><nav class="Bgc(barBackground) Bgc(t)--p Pos(a) Pos(s)--p T(0) Start(0) End(0) Bdbw(1px) Bdc(barBorder) H(50px) C(barText) C(black)--p Px(10px) Z(1)"><div class="W(100%) D(f) H(100%) Jc(sb) Ai(c) Ov(h)"><div class="D(f) Whs(nw) Ai(c) Fxs(1) Ov(h) Pend(12px)"><a class="C(barText) C(black)--p Fz(1.4em) Fw(b) Tov(e) Ov(h) Fxs(1) Td(n)--p Tov(e) D(b)" href=../../../ >Rumkin.com </a><span class="Px(0.3em) Fxs(0)">&gt;</span> <a class="C(barText) C(black)--p Fz(1.4em) Fw(b) Tov(e) Ov(h) Fxs(1) Td(n)--p Tov(e) D(b)" href=../../ >Programming Topics </a><span class="Px(0.3em) Fxs(0)">&gt;</span> <a class="C(barText) C(black)--p Fz(1.4em) Fw(b) Tov(e) Ov(h) Fxs(0) Td(n)--p Tov(e) D(b)" href=../ >Palm OS Programming</a></div></div></nav><div class="Bgc(pageBackground) Bgc(t)--p Fxg(1)"><div class="Mt(50px) Mt(0)--p C(textColorNormal) P(10px)"><div class="Mx(a) W(100%) Maw(contentWidthMax) Maw(100%)--p D(f) Px(10px) Pstart(0)"><main class="D(tbc) Va(t) W(100%)"><header><h1>Palm OS Programming - Advanced UI Elements</h1></header><div class=contents><p>This is the text, extracted from a presentation for Palm OS Programming Advanced UI elements. The gotchyas and pitfalls were skipped because I already had that in a <a href=../gotchyas/ >separate page</a>. I don&#39;t use Adobe and I wanted a textual reference instead of printing out slides, so I did this.</p><h2 id=anatomy-of-the-stock-event-loop>Anatomy of the Stock Event Loop</h2><pre><code>EventType event;
do {
    EvtGetEvent(&amp;event, evtWaitForever);
    if (! SysHandleEvent(&amp;event))
        if (! MenuHandleEvent(0, &amp;event, &amp;error))
            if (! AppHandleEvent(&amp;event))
                FrmDispatchEvent(&amp;event);
} while (event.eType != appStopEvent);
</code></pre><ul><li><code>FrmDispatchEvent</code> passes the event FIRST to the handler that was registered (usually by <code>AppHandleEvent</code>)</li><li>If the event wasn&#39;t handled (i.e. the handler returns <code>false</code>) it flows to <code>FrmHandleEvent</code>, where it receives default handling<ul><li>Keystrokes flow into fields</li><li><code>FrmUpdateEvent</code> calls <code>FrmDrawForm()</code></li></ul></li></ul><h2 id=opaque-ui-structures>Opaque UI Structures</h2><ul><li>Myth:<ul><li>UI structures are documented so you can edit their contents.</li></ul></li><li>Reality:<ul><li>UI structures are documented to help debugging.</li></ul></li></ul><h2 id=usable-and-visible>Usable and Visible</h2><ul><li>Myth:<ul><li>Applications can control which form objects draw by setting the &quot;visible&quot; bit.</li></ul></li><li>Reality:<ul><li>The &quot;visible&quot; bit is actually state information, not something you should be setting.</li><li>Use <code>FrmShowObject()</code> and <code>FrmHideObject()</code></li></ul></li></ul><h2 id=clipboard>Clipboard</h2><ul><li>Myth:<ul><li>The clipboard is just for boring text.</li></ul></li><li>Reality:<ul><li><p>You can put bitmaps on the clipboard, too!</p><pre><code>  ClipboardAddItem(clipboardBitmap, bitmapP, MemPtrSize(bitmapP));
</code></pre></li><li><p>Text and bitmap clipboards are separate; one doesn&#39;t overwrite the other</p></li></ul></li></ul><h2 id=custom-fonts>Custom Fonts</h2><ul><li>Myth:<ul><li>Custom fonts aren&#39;t supported.</li></ul></li><li>Reality:<ul><li>Custom fonts ARE supported. We don&#39;t make it easy (yet)..</li></ul></li></ul><h2 id=creating-a-custom-font>Creating a Custom Font</h2><ul><li>Fonts are NFNT resources (well, almost)<ul><li>Slight differences in header</li><li>Glyphs contain space</li></ul></li><li>No support in Constructor for creating fonts</li><li>But there are various third-party tools for creating and importing fonts<ul><li>xFont</li><li>PilRC</li><li>ResEdit (Macintosh)</li></ul></li></ul><h2 id=adding-a-font-to-your-project-pc>Adding a Font to your Project (PC)</h2><ul><li><p>Use xFont (freeware) to make a font in PilRC format</p><ul><li>Call it something like &quot;myFont.pfn&quot;</li><li>Or create font directly in PilRC format - See PilRC Manual for details</li></ul></li><li><p>Install <a href=http://www.calliopeinc.com/pilrcplugin.html>PilRC CodeWarrior plugin</a></p></li><li><p>Add a .rcp file to project with this line in it:</p><pre><code>  Font &#39;FONT&#39; FONTID 128 &quot;myFont.pfn&quot;
</code></pre></li><li><p>Compile and get a .r file containing a &quot;NFNT&quot; resource</p><ul><li>data &#39;NFNT&#39; (20052) means Resource ID is 20052</li></ul></li></ul><h2 id=installing-a-custom-font>Installing a Custom Font</h2><pre><code>MemHandle fontH;
FontType* fontP;
fontH = DmGetResource(fontResource, 25002);
fontP = (FontType*) MemHandleLock(fontH);
FntDefineFont(fntAppFontCustomBase, fontP);
MemHandleUnlock(fontH);
DmReleaseResource(fontH);
</code></pre><ul><li><code>fntAppFontCustomBase</code> is the first ID available<ul><li>add an offset when defining multiple fonts</li></ul></li></ul><h2 id=using-a-custom-font>Using a Custom Font</h2><ul><li><code>WinDrawChars</code> will now use this font<ul><li>if you call <code>FntSetFont(fntAppFontCustomBase)</code></li></ul></li><li><code>LstGlueSetFont</code>, <code>FrmGlueSetLabelFont</code>, <code>CtlGlueSetFont</code>, <code>TblSetItemFont</code> can then take <code>fntAppFontCustomBase</code> to set the list, form, control or table font to the new custom font</li></ul><h2 id=high-resolution-font-families>High Resolution Font Families</h2><pre><code>LowRes
NFNT 2000  ----&gt;      Constructor
                          or             ----&gt;   Family
  HiRes    ----&gt;  tfnf resource defines         NFNT 4000
NFNT 3000          font family members
</code></pre><ul><li>Use only on Palm OS 5 and later<ul><li>Not backwards compatible (check OS version!)</li></ul></li><li><code>DmGetResource(&#39;nfnt&#39;, myFontFamilyID);</code></li><li>From there use same as &quot;old style&quot; custom font</li></ul><h2 id=tables>Tables</h2><ul><li>Myth:<ul><li>Tables are Complicated</li></ul></li><li>Reality:<ul><li>Tables are Very Complicated</li></ul></li></ul><h2 id=do-you-really-need-a-table>Do You Really Need a Table?</h2><ul><li>Tables are ideal when:<ul><li>You need UI widgets embedded in a table<ul><li>fields, checkboxes, or anything that accepts input</li></ul></li></ul></li><li>Consider alternatives when:<ul><li>You simply want to display data in a multi-column format</li><li>You require scrolling<ul><li>Tables have no inherent scrolling functionality!</li></ul></li></ul></li></ul><h2 id=alternatives-to-tables>Alternatives to Tables</h2><ul><li>Lists<ul><li>Can have multiple columns when drawn by callback</li><li>Great when rows can select together</li></ul></li><li>Fields + Scrollbar<ul><li>Great for text-only data</li></ul></li><li>Gadgets<ul><li>Most flexible, most work</li><li>Get a rectangle that receives hits</li><li>Implement only the functionality you need</li></ul></li></ul><h2 id=attention-manager>Attention Manager</h2><ul><li>Myth:<ul><li>The Attention Manager is a 4.0 replacement for the Alarm Manager.</li></ul></li><li>Reality:<ul><li>The Attention Manager is a central UI repository for attention getting messages from all applications.</li></ul></li></ul><h2 id=step-1-call-the-attention-manager>Step 1: Call the Attention Manager</h2><ul><li><p>Often in response to an Alarm or Notification</p><p>AttnGetAttention(cardNo, dbID, userData, NULL, kAttlLevelSubtle, kAttnFlagsUseUserSettings, 5, 2); // Handle the launch code sysAppLaunchCmdAttention</p><p>case sysAppLaunchCmdAttention: HandleAttention((AttnLaunchCodeArgsType*)cmdPBP);</p></li></ul><h2 id=step-2-draw-the-attention-ui>Step 2: Draw the Attention UI</h2><pre><code>switch (cmdPBP-&gt;command)
    case kAttnCommandDrawList:
        // Draw the item in the list
    case kAttnCommandDrawDetail:
        // Draw the detail screen

/// Code to help you out
x = cmdPBP-&gt;commandArgsP-&gt;drawList.bounds.topLeft.x;
y = cmdPBP-&gt;commandArgsP-&gt;drawList.bounds.topLeft.y;
WinDrawBitmap(iconP, x, y);
x += kAttnListTextOffset;
WinDrawChars(theStr, StrLen(theStr), x, y);
</code></pre><h2 id=step-3-extras>Step 3: Extras</h2><ul><li><code>case kAttnCommandPlaySound</code><ul><li>Chance to play a custom sound</li><li>Sent if requested in <code>AttnGetAttention()</code> call</li></ul></li><li><code>case kAttnCommandCustomEffect</code><ul><li>Chance to do any other custom effect</li></ul></li></ul><h2 id=step-4-handle-users-choice>Step 4: Handle User&#39;s Choice</h2><pre><code>case kAttnCommandGotIt:
    // Selected the OK button

case kAttnCommandSnooze:
    // Selected the Snooze button

case kAttnCommandGoThere:
    // Selected the Go To button
    AttnForgetIt(cardNo, dbID, cmdPBP-&gt;userData);
    buf = (UInt32*) MemPtrNew(sizeof(UInt32));
    MemPtrSetOwner(buf, 0);
    *buf = paramP-&gt;userData;

    SysUIAppSwitch(cardNo, dbID,
                   sysAppLaunchCmdCustomBase, buf);
    // Handle sysAppLaunchCmdCustomBase in PalmMain()
</code></pre><h2 id=step-5-update-the-attention-manager>Step 5: Update the Attention Manager</h2><ul><li><code>AttnForgetIt</code> -- when something in the attention manager is no longer relevant</li><li><code>AttnIterate</code> -- Iterates through everything that belongs to your app and gives your callback a chance to handle each one<ul><li>Update all attentions</li><li>Erase all attentions</li></ul></li><li><code>AttnUpdate</code> -- Update specific attention</li><li><code>AttnGetCounts</code> -- Use to find out how many attentions you have pending</li></ul></div></main></div></div></div><footer class="Bgc(barBackground) Bgc(t)--p Bdtw(1px) Bdc(barBorder) C(barText) C(black)--p P(10px) D(f) Fxd(c)--p Jc(sb)"><div class=Fz(0.8em)>&copy; Copyright 2022 Tyler Akins &lt;<a class="Td(n)--p C(barText) C(black)--p" href=mailto:fidian@rumkin.com>fidian@rumkin.com</a>&gt;, last build 2022-08-18T01:49:12.224Z</div><div><a class="D(n)--p Fz(0.8em) C(barText)" href=../../../license/ >License</a> | <a class="D(n)--p Fz(0.8em) C(barText)" href=../../../reference/site/legal/ >Legal</a> <a class="D(n) D(b)--p Td(n) Fz(0.8em)" href=../../../license/ >Site content licensed under a MIT license with a non-advertising clause</a></div></footer></div></body></html>