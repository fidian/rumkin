<p>This is the text, extracted from a presentation for Palm OS Programming Advanced UI elements. The gotchyas and pitfalls were skipped because I already had that in a <a href=../gotchyas/ >separate page</a>. I don&#39;t use Adobe and I wanted a textual reference instead of printing out slides, so I did this. View the original information at <a href=http://www.palmsource.com/about/events/expo/2002/posteurope.html>PalmSource</a>.</p><h2 id=anatomy-of-the-stock-event-loop>Anatomy of the Stock Event Loop</h2><pre><code>EventType event;
do {
    EvtGetEvent(&amp;event, evtWaitForever);
    if (! SysHandleEvent(&amp;event))
        if (! MenuHandleEvent(0, &amp;event, &amp;error))
            if (! AppHandleEvent(&amp;event))
                FrmDispatchEvent(&amp;event);
} while (event.eType != appStopEvent);
</code></pre><ul><li><code>FrmDispatchEvent</code> passes the event FIRST to the handler that was registered (usually by <code>AppHandleEvent</code>)</li><li>If the event wasn&#39;t handled (i.e. the handler returns <code>false</code>) it flows to <code>FrmHandleEvent</code>, where it receives default handling<ul><li>Keystrokes flow into fields</li><li><code>FrmUpdateEvent</code> calls <code>FrmDrawForm()</code></li></ul></li></ul><h2 id=opaque-ui-structures>Opaque UI Structures</h2><ul><li>Myth:<ul><li>UI structures are documented so you can edit their contents.</li></ul></li><li>Reality:<ul><li>UI structures are documented to help debugging.</li></ul></li></ul><h2 id=usable-and-visible>Usable and Visible</h2><ul><li>Myth:<ul><li>Applications can control which form objects draw by setting the &quot;visible&quot; bit.</li></ul></li><li>Reality:<ul><li>The &quot;visible&quot; bit is actually state information, not something you should be setting.</li><li>Use <code>FrmShowObject()</code> and <code>FrmHideObject()</code></li></ul></li></ul><h2 id=clipboard>Clipboard</h2><ul><li>Myth:<ul><li>The clipboard is just for boring text.</li></ul></li><li>Reality:<ul><li><p>You can put bitmaps on the clipboard, too!</p><pre><code>  ClipboardAddItem(clipboardBitmap, bitmapP, MemPtrSize(bitmapP));
</code></pre></li><li><p>Text and bitmap clipboards are separate; one doesn&#39;t overwrite the other</p></li></ul></li></ul><h2 id=custom-fonts>Custom Fonts</h2><ul><li>Myth:<ul><li>Custom fonts aren&#39;t supported.</li></ul></li><li>Reality:<ul><li>Custom fonts ARE supported. We don&#39;t make it easy (yet)..</li></ul></li></ul><h2 id=creating-a-custom-font>Creating a Custom Font</h2><ul><li>Fonts are NFNT resources (well, almost)<ul><li>Slight differences in header</li><li>Glyphs contain space</li></ul></li><li>No support in Constructor for creating fonts</li><li>But there are various third-party tools for creating and importing fonts<ul><li>xFont</li><li>PilRC</li><li>ResEdit (Macintosh)</li></ul></li></ul><h2 id=adding-a-font-to-your-project-pc>Adding a Font to your Project (PC)</h2><ul><li><p>Use xFont (freeware) to make a font in PilRC format</p><ul><li>Call it something like &quot;myFont.pfn&quot;</li><li>Or create font directly in PilRC format - See PilRC Manual for details</li></ul></li><li><p>Install <a href=http://www.calliopeinc.com/pilrcplugin.html>PilRC CodeWarrior plugin</a></p></li><li><p>Add a .rcp file to project with this line in it:</p><pre><code>  Font &#39;FONT&#39; FONTID 128 &quot;myFont.pfn&quot;
</code></pre></li><li><p>Compile and get a .r file containing a &quot;NFNT&quot; resource</p><ul><li>data &#39;NFNT&#39; (20052) means Resource ID is 20052</li></ul></li></ul><h2 id=installing-a-custom-font>Installing a Custom Font</h2><pre><code>MemHandle fontH;
FontType* fontP;
fontH = DmGetResource(fontResource, 25002);
fontP = (FontType*) MemHandleLock(fontH);
FntDefineFont(fntAppFontCustomBase, fontP);
MemHandleUnlock(fontH);
DmReleaseResource(fontH);
</code></pre><ul><li><code>fntAppFontCustomBase</code> is the first ID available<ul><li>add an offset when defining multiple fonts</li></ul></li></ul><h2 id=using-a-custom-font>Using a Custom Font</h2><ul><li><code>WinDrawChars</code> will now use this font<ul><li>if you call <code>FntSetFont(fntAppFontCustomBase)</code></li></ul></li><li><code>LstGlueSetFont</code>, <code>FrmGlueSetLabelFont</code>, <code>CtlGlueSetFont</code>, <code>TblSetItemFont</code> can then take <code>fntAppFontCustomBase</code> to set the list, form, control or table font to the new custom font</li></ul><h2 id=high-resolution-font-families>High Resolution Font Families</h2><pre><code>LowRes
NFNT 2000  ----&gt;      Constructor
                          or             ----&gt;   Family
  HiRes    ----&gt;  tfnf resource defines         NFNT 4000
NFNT 3000          font family members
</code></pre><ul><li>Use only on Palm OS 5 and later<ul><li>Not backwards compatible (check OS version!)</li></ul></li><li><code>DmGetResource(&#39;nfnt&#39;, myFontFamilyID);</code></li><li>From there use same as &quot;old style&quot; custom font</li></ul><h2 id=tables>Tables</h2><ul><li>Myth:<ul><li>Tables are Complicated</li></ul></li><li>Reality:<ul><li>Tables are Very Complicated</li></ul></li></ul><h2 id=do-you-really-need-a-table>Do You Really Need a Table?</h2><ul><li>Tables are ideal when:<ul><li>You need UI widgets embedded in a table<ul><li>fields, checkboxes, or anything that accepts input</li></ul></li></ul></li><li>Consider alternatives when:<ul><li>You simply want to display data in a multi-column format</li><li>You require scrolling<ul><li>Tables have no inherent scrolling functionality!</li></ul></li></ul></li></ul><h2 id=alternatives-to-tables>Alternatives to Tables</h2><ul><li>Lists<ul><li>Can have multiple columns when drawn by callback</li><li>Great when rows can select together</li></ul></li><li>Fields + Scrollbar<ul><li>Great for text-only data</li></ul></li><li>Gadgets<ul><li>Most flexible, most work</li><li>Get a rectangle that receives hits</li><li>Implement only the functionality you need</li></ul></li></ul><h2 id=attention-manager>Attention Manager</h2><ul><li>Myth:<ul><li>The Attention Manager is a 4.0 replacement for the Alarm Manager.</li></ul></li><li>Reality:<ul><li>The Attention Manager is a central UI repository for attention getting messages from all applications.</li></ul></li></ul><h2 id=step-1-call-the-attention-manager>Step 1: Call the Attention Manager</h2><ul><li><p>Often in response to an Alarm or Notification</p><p>AttnGetAttention(cardNo, dbID, userData, NULL, kAttlLevelSubtle, kAttnFlagsUseUserSettings, 5, 2); // Handle the launch code sysAppLaunchCmdAttention</p><p>case sysAppLaunchCmdAttention: HandleAttention((AttnLaunchCodeArgsType*)cmdPBP);</p></li></ul><h2 id=step-2-draw-the-attention-ui>Step 2: Draw the Attention UI</h2><pre><code>switch (cmdPBP-&gt;command)
    case kAttnCommandDrawList:
        // Draw the item in the list
    case kAttnCommandDrawDetail:
        // Draw the detail screen

/// Code to help you out
x = cmdPBP-&gt;commandArgsP-&gt;drawList.bounds.topLeft.x;
y = cmdPBP-&gt;commandArgsP-&gt;drawList.bounds.topLeft.y;
WinDrawBitmap(iconP, x, y);
x += kAttnListTextOffset;
WinDrawChars(theStr, StrLen(theStr), x, y);
</code></pre><h2 id=step-3-extras>Step 3: Extras</h2><ul><li><code>case kAttnCommandPlaySound</code><ul><li>Chance to play a custom sound</li><li>Sent if requested in <code>AttnGetAttention()</code> call</li></ul></li><li><code>case kAttnCommandCustomEffect</code><ul><li>Chance to do any other custom effect</li></ul></li></ul><h2 id=step-4-handle-users-choice>Step 4: Handle User&#39;s Choice</h2><pre><code>case kAttnCommandGotIt:
    // Selected the OK button

case kAttnCommandSnooze:
    // Selected the Snooze button

case kAttnCommandGoThere:
    // Selected the Go To button
    AttnForgetIt(cardNo, dbID, cmdPBP-&gt;userData);
    buf = (UInt32*) MemPtrNew(sizeof(UInt32));
    MemPtrSetOwner(buf, 0);
    *buf = paramP-&gt;userData;

    SysUIAppSwitch(cardNo, dbID,
                   sysAppLaunchCmdCustomBase, buf);
    // Handle sysAppLaunchCmdCustomBase in PalmMain()
</code></pre><h2 id=step-5-update-the-attention-manager>Step 5: Update the Attention Manager</h2><ul><li><code>AttnForgetIt</code> -- when something in the attention manager is no longer relevant</li><li><code>AttnIterate</code> -- Iterates through everything that belongs to your app and gives your callback a chance to handle each one<ul><li>Update all attentions</li><li>Erase all attentions</li></ul></li><li><code>AttnUpdate</code> -- Update specific attention</li><li><code>AttnGetCounts</code> -- Use to find out how many attentions you have pending</li></ul>