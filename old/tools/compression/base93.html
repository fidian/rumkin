<html><head><title>Base 93 Compression</title>
<script language="JavaScript" src="/inc/js/browser_faster.js"></script>
<script language="javascript"><!--

var Chars = "";
for (i = 32; i < 127; i ++) {
	if (i != 34 && i != 92) {
		Chars += String.fromCharCode(i);
	}
}

function base93encode(str) {
	var out = new StringMaker();
	var bitsLeft, val, i, index;

	i = 0;
	while (i < str.length) {
		val = 0x1000000 + str.charCodeAt(i++);
		if (str.length > i)
		{
			val ^= 0x3000000;
			val += str.charCodeAt(i++) << 8;
		}
		if (str.length > i)
		{
			val ^= 0x1000000;
			val += str.charCodeAt(i++) << 16;
		}

		out.append(Chars.charAt(val % Chars.length));
		val = (val - (val % Chars.length)) / Chars.length;
		out.append(Chars.charAt(val % Chars.length));
		val = (val - (val % Chars.length)) / Chars.length;
		out.append(Chars.charAt(val % Chars.length));
		val = (val - (val % Chars.length)) / Chars.length;
		out.append(Chars.charAt(val % Chars.length));
	}
	return out.toString();
}

function base93decode(str) {
	var val, out, i, j;
	var out = new StringMaker();
	i = 0;
	while (i < str.length) {
		val = 0;
		for (j = 3; j >= 0; j --) {
			val = val * Chars.length + Chars.indexOf(str.charAt(i+j));
		}
		i += 4;

		j = ((val >> 24) & 0x03);

		while (j --) {
			if (String.fromCharCode(val & 0xFF)) {
				out.append(String.fromCharCode(val & 0xFF));
			}
			val >>= 8;
		}
	}
	return out.toString();
}

function RunSquish() {
    document.compform.squished.value = base93encode(document.compform.from.value);
    document.compform.unsquished.value = base93decode(document.compform.squished.value);
    if (document.compform.from.value == document.compform.unsquished.value) {
        document.compform.result.value = "Works!";
    } else {
        document.compform.result.value = "Broken.  :-(";
    }
}
// --></script>
</head>
<body bgcolor=#FFFFFF>
<form method=post action="#" onsubmit="return false" name=compform>

<p>From:
<textarea name=from rows=5 cols=80>This is just some sample text.
I sure hope that it works out fine.
We shall see.</textarea>

<p><input type=button onclick="RunSquish()" value="Squisharoo"></p>

<p>Squished:
<textarea name=squished rows=5 cols=80></textarea>

<p>Unsquished:
<textarea name=unsquished rows=5 cols=80></textarea>

<p>Result: 
<input type=text size=50 name=result value=""></p>
</form>
