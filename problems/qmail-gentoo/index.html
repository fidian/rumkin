<!DOCTYPE html><html lang=en class="H(100%) Ovy(h)"><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Setting up Qmail on Gentoo</title><link rel=stylesheet href=../../css/reset.css?1662579161655><link rel=stylesheet href=../../css/atomic.css?1662579161655><link rel=stylesheet href=../../css/fonts.css?1662579161655><link rel=stylesheet href=../../css/site.css?1662579161655><link rel=apple-touch-icon sizes=180x180 href=../../img/favicon/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../img/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../img/favicon/favicon-16x16.png><link rel=manifest href=../../img/favicon/manifest.json><link rel=mask-icon href=../../img/favicon/safari-pinned-tab.svg color=#5bbad5><link rel="shortcut icon" href=../../img/favicon/favicon.ico><meta name=msapplication-config content=../../img/favicon/browserconfig.xml><meta name=theme-color content=#ffffff><link rel=license href=../../license><script async src="https://www.googletagmanager.com/gtag/js?id=G-H1S197ZSNH"></script><script>window.dataLayer = window.dataLayer || [];
function gtag() { dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'G-H1S197ZSNH');</script></head><body class="H(100%) Ovx(h) Bgc(pageBorderBackground) Bgc(t)--p"><div class="Maw(1002px) H(100%) W(100%) D(f) Fxd(c) Maw(100%)--p Mx(a) Mx(0)--p"><nav class="Bgc(barBackground) Bgc(t)--p Pos(a) Pos(s)--p T(0) Start(0) End(0) Bdbw(1px) Bdc(barBorder) H(50px) C(barText) C(black)--p Px(10px) Z(1)"><div class="W(100%) D(f) H(100%) Jc(sb) Ai(c) Ov(h)"><div class="D(f) Whs(nw) Ai(c) Fxs(1) Ov(h) Pend(12px)"><a class="C(barText) C(black)--p Fz(1.4em) Fw(b) Tov(e) Ov(h) Fxs(1) Td(n)--p Tov(e) D(b)" href=../../ >Rumkin.com </a><span class="Px(0.3em) Fxs(0)">&gt;</span> <a class="C(barText) C(black)--p Fz(1.4em) Fw(b) Tov(e) Ov(h) Fxs(0) Td(n)--p Tov(e) D(b)" href=../ >Problems Only Tyler Has</a></div></div></nav><div class="Bgc(pageBackground) Bgc(t)--p Fxg(1)"><div class="Mt(50px) Mt(0)--p C(textColorNormal) P(10px)"><div class="Mx(a) W(100%) Maw(contentWidthMax) Maw(100%)--p D(f) Px(10px) Pstart(0)"><main class="D(tbc) Va(t) W(100%)"><header><h1>Setting up Qmail on Gentoo</h1><div class=Px(20px)><div class="Bgc(#c5e0f9) Bgc(t)--p Fs(i) Py(4px) Px(8px)">Brief list of instructions necessary to get qmail up and running on an older version of Gentoo.</div></div></header><div class=contents><p>I ran a mail server for a long time. I also really liked qmail, but setting it up in the past was a pain.</p><h2 id=problem>Problem</h2><p>You want to use qmail or netqmail on Gentoo. Unfortunately, the guides out there all seem complex, inaccurate, or just not what you want.</p><h2 id=solution>Solution</h2><p>The solution presented will be succinct. I won&#39;t go into how you set up use flags nor dependencies too much. Feel free to alter my instructions to fit your needs.</p><ol><li>Remove other MTAs - <code>emerge -C ssmtp sendmail postfix</code></li><li>Tweak your use flags<ul><li>fam (courier-imap) - We&#39;ll be installing a file alteration monitor (gamin)</li><li>qmail (spamassassin) - We use qmail now</li><li>pyzord (pyzor) - Use a daemon</li><li>spamassassin (qmail-scanner) - Compile in support for Spamassassin</li></ul></li><li>Emerge packages<ul><li>netqmail - An updated form of qmail</li><li>relay-ctrl - Allow relaying for authenticated users</li><li>courier-imap - IMAP daemon</li><li>gamin - File alteration monitor</li><li>razor - Spam scanner</li><li>Mail-SPF-Query - For SPF support in Spamassassin</li><li>spamassassin - Spam scanner</li><li>pyzor - Spam scanner</li><li>dcc - Spam scanner</li><li>clamav - Antivirus</li><li>zip, zoo, lha, rar, unrar (optional) - for scanning attachments</li><li>bitdefender-console - Antivirus</li><li>f-prot - Antivirus</li><li>ripmime, tnef - Attachment extractor</li><li>qmail-scanner - Message scanner</li></ul></li><li>Configure qmail<ul><li>Set up Qmail&#39;s certificate. I already have certificates, so I just copied those in. cp rumkin.pem /var/qmail/control/servercert.pem chown root:qmail /var/qmail/control/servercert.pem chmod 644 /var/qmail/control/servercert.pem /etc/init.d/svscan restart ebuild /var/db/pkg/mail-mta/netqmail-1.05-r8/netqmail-1.05-r8.ebuild config</li><li>Set up common system aliases cd /var/qmail/alias/ echo SOME_ADDRESS &gt; .qmail-root for F in postmaster webaster mailer-daemon anonymous; do ln -s .qmail-root .qmail-${F}; done chmod 644 .qmail-*</li><li>List machines whose email you are allowed to receive - /var/qmail/control/locals YOUR_MACHINE&#39;S_HOST_NAME localhost YOURDOMAIN.com YOUR_MACHINE.YOURDOMAIN.com localhost.YOURDOMAIN.com</li><li>Start at boot - <code>rc-update add svscan default</code></li><li>Start qmail - <code>/etc/init.d/svscan start</code></li></ul></li><li>Test qmail<ul><li>First off, <code>emerge telnet</code> if you don&#39;t have it or use <code>nc</code> if you prefer</li><li>Replace the stuff like <em>yourdomain.com</em> in the transcript below and there is an intentional blank line so be careful telnet localhost smtp HELO yourdomain.com MAIL FROM: <a href=mailto:&#121;&#x6f;&#x75;&#x72;&#x2e;&#101;&#109;&#x61;&#105;&#x6c;&#x40;&#x79;&#111;&#x75;&#x72;&#x64;&#111;&#x6d;&#x61;&#x69;&#110;&#x2e;&#99;&#x6f;&#x6d;>&#121;&#x6f;&#x75;&#x72;&#x2e;&#101;&#109;&#x61;&#105;&#x6c;&#x40;&#x79;&#111;&#x75;&#x72;&#x64;&#111;&#x6d;&#x61;&#x69;&#110;&#x2e;&#99;&#x6f;&#x6d;</a> RCPT TO: <a href=mailto:&#x79;&#111;&#117;&#114;&#x2e;&#x65;&#x6d;&#x61;&#105;&#108;&#64;&#x79;&#x6f;&#x75;&#x72;&#100;&#111;&#x6d;&#97;&#x69;&#x6e;&#x2e;&#x63;&#x6f;&#109;>&#x79;&#111;&#117;&#114;&#x2e;&#x65;&#x6d;&#x61;&#105;&#108;&#64;&#x79;&#x6f;&#x75;&#x72;&#100;&#111;&#x6d;&#97;&#x69;&#x6e;&#x2e;&#x63;&#x6f;&#109;</a> DATA Subject: Test message . QUIT</li><li>Check your email for a test message.</li></ul></li><li>Install relay-ctrl<ul><li>Edit <code>/etc/tcprules.d/tcp.qmail-*</code> and just follow the comments</li><li>Rebuild the tcprules cd /etc/tcprules.d make chmod 644 *.cdb</li><li>If you can receive email but can no longer send email, edit your tcp.qmail</li><li>Restart qmail - <code>/etc/init.d/svscan restart</code></li></ul></li><li>Install qmail-scanner<ul><li>Edit <code>/etc/tcprules.d/tcp.qmail-*</code> and change the allow line :allow,QMAILQUEUE=&quot;/var/qmail/bin/qmail-scanner-queue&quot;</li><li>Rebuild tcpfules as per &quot;Install relay-ctrl&quot; section</li></ul></li></ol><p>With luck, problem solved.</p><h2 id=shortcomings>Shortcomings</h2><p>If you see some problems with qmail-scanner communicating with clamav, re-emerge perl with the perlsuid use flag.</p></div></main></div></div></div><footer class="Bgc(barBackground) Bgc(t)--p Bdtw(1px) Bdc(barBorder) C(barText) C(black)--p P(10px) D(f) Fxd(c)--p Jc(sb)"><div class=Fz(0.8em)>&copy; Copyright 2022 Tyler Akins &lt;<a class="Td(n)--p C(barText) C(black)--p" href=mailto:fidian@rumkin.com>fidian@rumkin.com</a>&gt;, last build 2022-09-07T19:32:41.655Z</div><div><a class="D(n)--p Fz(0.8em) C(barText)" href=../../license/ >License</a> | <a class="D(n)--p Fz(0.8em) C(barText)" href=../../reference/site/legal/ >Legal</a> <a class="D(n) D(b)--p Td(n) Fz(0.8em)" href=../../license/ >Site content licensed under a MIT license with a non-advertising clause</a></div></footer></div></body></html>