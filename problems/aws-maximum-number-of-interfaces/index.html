<!DOCTYPE html><html lang=en class="H(100%) Ovy(h)"><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>AWS Maximum Number of Interfaces Exceecded</title><script src=../../js/acss-live.js></script><link rel=stylesheet href=../../css/reset.css?1673669567794><link rel=stylesheet href=../../css/fonts.css?1673669567794><link rel=stylesheet href=../../css/site.css?1673669567794><link rel=apple-touch-icon sizes=180x180 href=../../img/favicon/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../img/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../img/favicon/favicon-16x16.png><link rel=manifest href=../../img/favicon/manifest.json><link rel=mask-icon href=../../img/favicon/safari-pinned-tab.svg color=#5bbad5><link rel="shortcut icon" href=../../img/favicon/favicon.ico><meta name=msapplication-config content=../../img/favicon/browserconfig.xml><meta name=theme-color content=#ffffff><link rel=license href=../../license><script async src="https://www.googletagmanager.com/gtag/js?id=G-H1S197ZSNH"></script><script>window.dataLayer = window.dataLayer || [];
function gtag() { dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'G-H1S197ZSNH');</script></head><body class="H(100%) Ovx(h) Bgc(pageBorderBackground) Bgc(t)--p"><div class="Maw(1002px) H(100%) W(100%) D(f) Fxd(c) Maw(100%)--p Mx(a) Mx(0)--p"><nav class="Bgc(barBackground) Bgc(t)--p Pos(a) Pos(s)--p T(0) Start(0) End(0) Bdbw(1px) Bdc(barBorder) H(50px) C(barText) C(black)--p Px(10px) Z(1)"><div class="W(100%) D(f) H(100%) Jc(sb) Ai(c) Ov(h)"><div class="D(f) Whs(nw) Ai(c) Fxs(1) Ov(h) Pend(12px)"><a class="C(barText) C(black)--p Fz(1.4em) Fw(b) Tov(e) Ov(h) Fxs(1) Td(n)--p Tov(e) D(b)" href=../../ >Rumkin.com </a><span class="Px(0.3em) Fxs(0)">&gt;</span> <a class="C(barText) C(black)--p Fz(1.4em) Fw(b) Tov(e) Ov(h) Fxs(0) Td(n)--p Tov(e) D(b)" href=../ >Problems Only Tyler Has</a></div></div></nav><div class="Bgc(pageBackground) Bgc(t)--p Fxg(1)"><div class="Mt(50px) Mt(0)--p C(textColorNormal) P(10px)"><div class="Mx(a) W(100%) Maw(contentWidthMax) Maw(100%)--p D(f) Px(10px) Pstart(0)"><main class="D(tbc) Va(t) W(100%)"><header><h1>AWS Maximum Number of Interfaces Exceecded</h1><div class=Px(20px)><div class="Bgc(#c5e0f9) Bgc(t)--p Fs(i) Py(4px) Px(8px)">Had difficulty making a new instance when we didn't hit our instance limit. What could have been the problem?</div></div></header><div class=contents><p>We were trying to spin up a jump host to access an environment that is hosted in AWS. This is with an established piece of software and it had the right keys. Also, it said the maximum number of <em>interfaces</em>, not <em>instances</em>, so most of the web pages that existed did not have relevant information.</p><h2 id=symptoms>Symptoms</h2><ul><li>The AWS API reported the following message:<blockquote><p>ClientError: An error occurred (ResourceLimitExceeded) when calling the RunInstances operation: You have exceeded the maximum number of interfaces allowed for your account</p></blockquote></li></ul><h2 id=causes>Causes</h2><ul><li>The default limit of security groups per instance is 50. For brevity, I&#39;ll call this GROUPS.</li><li>The default limit of rules per security group is 5. Let&#39;s name the value RULES.</li><li>The maximum value of <code>GROUPS × RULES</code> can be 250 for performance reasons.</li><li>We were trying to add more than five security groups to the instance that we were creating.</li></ul><h2 id=solution>Solution</h2><p>The first solution is to reduce the maximum number of rules per security group. We were trying to add 15 security groups to our instance. By doing some algebra, we can divide 250 by 15 to get a limit of 16⅔ rules per security group. Any more than 16 would make <code>GROUPS × RULES &gt; 250</code> and that&#39;s not allowed.</p><p>One of the rules we are trying to attach has 18 rules, so we would be forbidden from adding that rule. An alternative bit of math would divide 250 by 18 to get just under 14 security groups per instance.</p><p>Amazon suggested we give up on our security group scheme because it is primarily based on single rules. For example, a security group that was applied to a web server might expose port 80 or possibly both 80 and 443. They would recommend building larger, aggregated security groups with more rules. This approach won&#39;t work well because we have very specialized machines that don&#39;t open a lot of ports.</p><p>Our setup also used security groups to allow access to services. For instance, we&#39;d grant a <code>serviceNameSource</code> security group to an ELB and <code>serviceName</code> to the instance. The <code>serviceName</code> security group would allow traffic from only <code>serviceNameSource</code>. Seems like a nice, tight way to control our network.</p><p>To get around this problem, we stopped adding <code>serviceNameSource</code> style security groups to our jump host. Because the jump host was able to get to any machine, it had many security groups of this flavor. Instead, the <code>serviceName</code> security group was modified to allow incoming traffic from <code>serviceNameSource</code> and a <code>jumpHost</code> security group. New jump host instances are created with the <code>jumpHost</code> security group and now we can access everything again and use fewer security groups per instance.</p><p>Problem solved.</p></div></main></div></div></div><footer class="Bgc(barBackground) Bgc(t)--p Bdtw(1px) Bdc(barBorder) C(barText) C(black)--p P(10px) D(f) Fxd(c)--p Jc(sb)"><div class=Fz(0.8em)>&copy; Copyright 2023 Tyler Akins &lt;<a class="Td(n)--p C(barText) C(black)--p" href=mailto:fidian@rumkin.com>fidian@rumkin.com</a>&gt;, last build 2023-01-14T04:12:47.794Z</div><div><a class="D(n)--p Fz(0.8em) C(barText)" href=../../license/ >License</a> | <a class="D(n)--p Fz(0.8em) C(barText)" href=../../reference/site/legal/ >Legal</a> <a class="D(n) D(b)--p Td(n) Fz(0.8em)" href=../../license/ >Site content licensed under a MIT license with a non-advertising clause</a></div></footer></div></body></html>