<p>We were trying to spin up a jump host to access an environment that is hosted in AWS. This is with an established piece of software and it had the right keys. Also, it said the maximum number of <em>interfaces</em>, not <em>instances</em>, so most of the web pages that existed did not have relevant information.</p><h2 id=symptoms>Symptoms</h2><ul><li>The AWS API reported the following message:<blockquote><p>ClientError: An error occurred (ResourceLimitExceeded) when calling the RunInstances operation: You have exceeded the maximum number of interfaces allowed for your account</p></blockquote></li></ul><h2 id=causes>Causes</h2><ul><li>The default limit of security groups per instance is 50. For brevity, I&#39;ll call this GROUPS.</li><li>The default limit of rules per security group is 5. Let&#39;s name the value RULES.</li><li>The maximum value of <code>GROUPS × RULES</code> can be 250 for performance reasons.</li><li>We were trying to add more than five security groups to the instance that we were creating.</li></ul><h2 id=solution>Solution</h2><p>The first solution is to reduce the maximum number of rules per security group. We were trying to add 15 security groups to our instance. By doing some algebra, we can divide 250 by 15 to get a limit of 16⅔ rules per security group. Any more than 16 would make <code>GROUPS × RULES &gt; 250</code> and that&#39;s not allowed.</p><p>One of the rules we are trying to attach has 18 rules, so we would be forbidden from adding that rule. An alternative bit of math would divide 250 by 18 to get just under 14 security groups per instance.</p><p>Amazon suggested we give up on our security group scheme because it is primarily based on single rules. For example, a security group that was applied to a web server might expose port 80 or possibly both 80 and 443. They would recommend building larger, aggregated security groups with more rules. This approach won&#39;t work well because we have very specialized machines that don&#39;t open a lot of ports.</p><p>Our setup also used security groups to allow access to services. For instance, we&#39;d grant a <code>serviceNameSource</code> security group to an ELB and <code>serviceName</code> to the instance. The <code>serviceName</code> security group would allow traffic from only <code>serviceNameSource</code>. Seems like a nice, tight way to control our network.</p><p>To get around this problem, we stopped adding <code>serviceNameSource</code> style security groups to our jump host. Because the jump host was able to get to any machine, it had many security groups of this flavor. Instead, the <code>serviceName</code> security group was modified to allow incoming traffic from <code>serviceNameSource</code> and a <code>jumpHost</code> security group. New jump host instances are created with the <code>jumpHost</code> security group and now we can access everything again and use fewer security groups per instance.</p><p>Problem solved.</p>